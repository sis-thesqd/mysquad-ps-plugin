"use strict";import{firstFocusableIn as p,firstFocusableSlottedIn as u}from"@spectrum-web-components/shared/src/first-focusable-in.js";import{VirtualTrigger as m}from"./VirtualTrigger.js";import{BeforetoggleClosedEvent as h,BeforetoggleOpenEvent as f,guaranteedAllTransitionend as E}from"./AbstractOverlay.js";export function OverlayDialog(a){class c extends a{async manageDialogOpen(){const e=this.open;if(await this.managePosition(),this.open!==e||this.open!==e)return;const o=await this.dialogMakeTransition(e);this.open===e&&await this.dialogApplyFocus(e,o)}async dialogMakeTransition(e){let o=null;const d=(t,s)=>async()=>{if(typeof t.open!="undefined"&&(t.open=e),!e){const n=()=>{t.removeEventListener("close",n),r(t,s)};t.addEventListener("close",n)}if(s>0)return;const i=e?f:h;this.dispatchEvent(new i),e&&(o=o||p(t),o||t.querySelectorAll("slot").forEach(l=>{o||(o=u(l))}),!(!this.isConnected||this.dialogEl.open)&&this.dialogEl.showModal())},r=(t,s)=>()=>{if(this.open!==e)return;const i=e?"sp-opened":"sp-closed";if(s>0){t.dispatchEvent(new CustomEvent(i,{bubbles:!1,composed:!1,detail:{interaction:this.type}}));return}if(!this.isConnected||e!==this.open)return;const n=()=>{const l=this.triggerElement instanceof m;this.dispatchEvent(new Event(i,{bubbles:l,composed:l})),t.dispatchEvent(new Event(i,{bubbles:!1,composed:!1})),this.triggerElement&&!l&&this.triggerElement.dispatchEvent(new CustomEvent(i,{bubbles:!0,composed:!0,detail:{interaction:this.type}})),this.state=e?"opened":"closed"};!e&&this.dialogEl.open?(this.dialogEl.addEventListener("close",()=>{n()},{once:!0}),this.dialogEl.close()):n()};return this.elements.forEach((t,s)=>{E(t,d(t,s),r(t,s))}),o}async dialogApplyFocus(e,o){this.applyFocus(e,o)}}return c}
//# sourceMappingURL=OverlayDialog.js.map
