"use strict";import{firstFocusableIn as f,firstFocusableSlottedIn as u}from"@spectrum-web-components/shared/src/first-focusable-in.js";import{VirtualTrigger as E}from"./VirtualTrigger.js";import{BeforetoggleClosedEvent as y,BeforetoggleOpenEvent as b,guaranteedAllTransitionend as P,nextFrame as c,overlayTimer as d}from"./AbstractOverlay.js";export function OverlayPopover(m){class v extends m{async manageDelay(e){if(e===!1||e!==this.open){d.close(this);return}this.delayed&&await d.openTimer(this)&&(this.open=!e)}async shouldHidePopover(e){e&&this.open!==e||await this.placementController.resetOverlayPosition()}async shouldShowPopover(e){let t=!1;try{t=this.dialogEl.matches(":popover-open")}catch(a){}let l=!1;try{l=this.dialogEl.matches(":open")}catch(a){}e&&this.open===e&&!t&&!l&&this.isConnected&&(this.dialogEl.showPopover(),await this.managePosition())}async ensureOnDOM(e){await c(),await this.shouldHidePopover(e),await this.shouldShowPopover(e),await c()}async makeTransition(e){if(this.open!==e)return null;let t=null;const l=(o,i)=>()=>{if(typeof o.open!="undefined"&&(o.open=e),i===0){const s=e?b:y;this.dispatchEvent(new s)}if(!e||(t=t||f(o),t))return;o.querySelectorAll("slot").forEach(s=>{t||(t=u(s))})},a=(o,i)=>async()=>{if(this.open!==e)return;const r=e?"sp-opened":"sp-closed";if(i>0){o.dispatchEvent(new CustomEvent(r,{bubbles:!1,composed:!1,detail:{interaction:this.type}}));return}const s=async()=>{if(this.open!==e)return;await c();const n=this.triggerElement instanceof E;this.dispatchEvent(new Event(r,{bubbles:n,composed:n})),o.dispatchEvent(new CustomEvent(r,{bubbles:!1,composed:!1,detail:{interaction:this.type}})),this.triggerElement&&!n&&this.triggerElement.dispatchEvent(new CustomEvent(r,{bubbles:!0,composed:!0,detail:{interaction:this.type}})),this.state=e?"opened":"closed"};if(this.open!==e)return;let h=!1;try{h=this.dialogEl.matches(":popover-open")}catch(n){}let p=!1;try{p=this.dialogEl.matches(":open")}catch(n){}e!==!0&&(h||p)&&this.isConnected?(this.dialogEl.addEventListener("beforetoggle",()=>{s()},{once:!0}),this.dialogEl.hidePopover()):s()};return this.elements.forEach((o,i)=>{P(o,l(o,i),a(o,i))}),t}}return v}
//# sourceMappingURL=OverlayPopover.js.map
